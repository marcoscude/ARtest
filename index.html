<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <title>ARbiblio - Esperienza Biblioteca Parma</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />

    <!-- A-Frame -->
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>

    <!-- AR.js per A-Frame (marker-based) -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

    <!-- Script di interazione -->
    <script src="./js/interactions.js" defer></script>

    <style>
      body {
        margin: 0;
        overflow: hidden;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      }

      /* Messaggi UI */
      #loadingMessage {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0,0,0,0.8);
        color: white;
        padding: 12px 20px;
        border-radius: 12px;
        font-size: 15px;
        z-index: 100;
        transition: all 0.3s;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      }
      #loadingMessage.found {
        background: rgba(0, 150, 0, 0.9);
      }

      /* Bottone Avvia Esperienza */
      #startExperienceBtn {
        position: fixed;
        bottom: 40px;
        left: 50%;
        transform: translateX(-50%);
        background: #CC0000;
        color: white;
        border: none;
        padding: 16px 40px;
        border-radius: 50px;
        font-size: 18px;
        font-weight: bold;
        z-index: 100;
        cursor: pointer;
        box-shadow: 0 6px 20px rgba(204, 0, 0, 0.4);
        transition: all 0.3s;
        display: none;
        text-transform: uppercase;
        letter-spacing: 1px;
      }
      #startExperienceBtn:active {
        transform: translateX(-50%) scale(0.95);
        box-shadow: 0 4px 15px rgba(204, 0, 0, 0.5);
      }

      /* Pannello Debug XYZ */
      #debugPanel {
        position: fixed;
        top: 80px;
        right: 10px;
        background: rgba(0,0,0,0.9);
        color: white;
        padding: 15px;
        border-radius: 10px;
        font-size: 11px;
        z-index: 99;
        max-width: 280px;
        display: none;
      }
      #debugPanel.active {
        display: block;
      }
      .debug-control {
        margin: 8px 0;
      }
      .debug-control label {
        display: block;
        margin-bottom: 4px;
        font-weight: bold;
        color: #00FFAA;
      }
      .debug-control input[type="range"] {
        width: 100%;
      }
      .debug-control .value {
        color: #FFD700;
        float: right;
      }
      .debug-object {
        border-top: 1px solid #444;
        padding-top: 10px;
        margin-top: 10px;
      }
      .debug-object:first-child {
        border-top: none;
        padding-top: 0;
        margin-top: 0;
      }
      #debugToggle {
        position: fixed;
        top: 80px;
        right: 10px;
        background: rgba(0,0,0,0.7);
        color: white;
        border: 1px solid #00FFAA;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 11px;
        z-index: 100;
        cursor: pointer;
      }
    </style>
  </head>

  <body>
    <!-- Messaggi di stato -->
    <div id="loadingMessage">Inizializzazione AR‚Ä¶ inquadra il marker.</div>

    <!-- Bottone Avvia Esperienza (appare quando marker trovato) -->
    <button id="startExperienceBtn">Avvia l'esperienza</button>

    <!-- Toggle Debug Panel -->
    <button id="debugToggle" style="display: none;">‚öôÔ∏è Debug</button>

    <!-- Pannello Debug XYZ -->
    <div id="debugPanel">
      <h4 style="margin: 0 0 10px 0; color: #FFD700;">üéõÔ∏è Posizionamento Oggetti</h4>

      <!-- Biblioteca Sinistra -->
      <div class="debug-object">
        <h5 style="margin: 0 0 8px 0;">2.3_Biblioteca (Sinistra)</h5>
        <div class="debug-control">
          <label>X: <span class="value" id="obj1-x-val">-1.5</span></label>
          <input type="range" id="obj1-x" min="-5" max="5" step="0.1" value="-1.5">
        </div>
        <div class="debug-control">
          <label>Y: <span class="value" id="obj1-y-val">-0.5</span></label>
          <input type="range" id="obj1-y" min="-3" max="3" step="0.1" value="-0.5">
        </div>
        <div class="debug-control">
          <label>Z: <span class="value" id="obj1-z-val">-3</span></label>
          <input type="range" id="obj1-z" min="-10" max="0" step="0.1" value="-3">
        </div>
        <div class="debug-control">
          <label>Scala: <span class="value" id="obj1-scale-val">0.3</span></label>
          <input type="range" id="obj1-scale" min="0.05" max="2" step="0.05" value="0.3">
        </div>
      </div>

      <!-- Biblioteca Centro -->
      <div class="debug-object">
        <h5 style="margin: 0 0 8px 0;">2.4_Biblioteca (Centro)</h5>
        <div class="debug-control">
          <label>X: <span class="value" id="obj2-x-val">0</span></label>
          <input type="range" id="obj2-x" min="-5" max="5" step="0.1" value="0">
        </div>
        <div class="debug-control">
          <label>Y: <span class="value" id="obj2-y-val">-0.5</span></label>
          <input type="range" id="obj2-y" min="-3" max="3" step="0.1" value="-0.5">
        </div>
        <div class="debug-control">
          <label>Z: <span class="value" id="obj2-z-val">-4</span></label>
          <input type="range" id="obj2-z" min="-10" max="0" step="0.1" value="-4">
        </div>
        <div class="debug-control">
          <label>Scala: <span class="value" id="obj2-scale-val">0.3</span></label>
          <input type="range" id="obj2-scale" min="0.05" max="2" step="0.05" value="0.3">
        </div>
      </div>

      <!-- Piani Destra -->
      <div class="debug-object">
        <h5 style="margin: 0 0 8px 0;">2.5_PianiParma (Destra)</h5>
        <div class="debug-control">
          <label>X: <span class="value" id="obj3-x-val">1.5</span></label>
          <input type="range" id="obj3-x" min="-5" max="5" step="0.1" value="1.5">
        </div>
        <div class="debug-control">
          <label>Y: <span class="value" id="obj3-y-val">-0.5</span></label>
          <input type="range" id="obj3-y" min="-3" max="3" step="0.1" value="-0.5">
        </div>
        <div class="debug-control">
          <label>Z: <span class="value" id="obj3-z-val">-3</span></label>
          <input type="range" id="obj3-z" min="-10" max="0" step="0.1" value="-3">
        </div>
        <div class="debug-control">
          <label>Scala: <span class="value" id="obj3-scale-val">0.3</span></label>
          <input type="range" id="obj3-scale" min="0.05" max="2" step="0.05" value="0.3">
        </div>
      </div>

      <button style="width: 100%; margin-top: 10px; padding: 8px; background: #00FFAA; color: black; border: none; border-radius: 6px; font-weight: bold; cursor: pointer;" onclick="saveDebugPositions()">üíæ Salva Posizioni</button>
    </div>

    <!-- Scena A-Frame AR -->
    <a-scene
      embedded
      vr-mode-ui="enabled: false"
      renderer="logarithmicDepthBuffer: true;"
      arjs="sourceType: webcam; debugUIEnabled: false;"
      id="scene"
    >
      <!-- Assets con timeout per caricamento -->
      <a-assets timeout="30000">
        <!-- Immagine PNG Markernote (senza crossorigin per compatibilit√† Chrome) -->
        <img id="markernote-img" src="./assets/Markernote1.png">
        <!-- Modelli 3D Biblioteche - tutti in scala 1:1 -->
        <a-asset-item id="model-biblioteca-sx" src="./assets/2.3_Biblioteca.glb"></a-asset-item>
        <a-asset-item id="model-biblioteca-centro" src="./assets/2.4_BibliotecaParma_2.glb"></a-asset-item>
        <a-asset-item id="model-piani-dx" src="./assets/2.5_PianiParma.glb"></a-asset-item>
      </a-assets>

      <!-- Marker -->
      <a-marker
        type="pattern"
        url="./assets/marker.patt"
        id="marker"
        emitevents="true"
        smooth="true"
        smoothCount="5"
        smoothTolerance="0.01"
        smoothThreshold="2"
      >
        <!-- PNG Markernote1 - Ancorato al marker, visibile quando trovato -->
        <a-plane
          id="markerNote"
          position="0 0.5 0"
          rotation="-90 0 0"
          width="1"
          height="1.25"
          material="src: #markernote-img; shader: flat; side: double; transparent: true; alphaTest: 0.5"
          visible="false"
        ></a-plane>
      </a-marker>

      <!-- Camera AR (senza look-controls per AR) -->
      <a-entity id="camera" camera></a-entity>

      <!-- Container World-Space per oggetti 3D (posizionati davanti alla camera) -->
      <a-entity id="worldAnchor" visible="false">

        <!-- 2.3_Biblioteca - SINISTRA -->
        <a-entity
          id="biblioteca-sx"
          gltf-model="#model-biblioteca-sx"
          position="-1.5 -0.5 -3"
          scale="0.3 0.3 0.3"
          rotation="0 0 0"
        ></a-entity>

        <!-- 2.4_BibliotecaParma_2 - CENTRO (davanti) -->
        <a-entity
          id="biblioteca-centro"
          gltf-model="#model-biblioteca-centro"
          position="0 -0.5 -4"
          scale="0.3 0.3 0.3"
          rotation="0 0 0"
        ></a-entity>

        <!-- 2.5_PianiParma - DESTRA -->
        <a-entity
          id="piani-dx"
          gltf-model="#model-piani-dx"
          position="1.5 -0.5 -3"
          scale="0.3 0.3 0.3"
          rotation="0 0 0"
        ></a-entity>

      </a-entity>

    </a-scene>
  </body>
</html>
